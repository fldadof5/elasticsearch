PLAY [master_nodes] *******************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ****************************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : os-specific vars] ***********************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Set the defaults here otherwise they can't be overriden in the same play if the role is called twice] ***********************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Use the oss repo and package if xpack is not being used] ********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Set the URL scheme to https if SSL/TLS is enabled] **************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : fail when es_proxy_port is not defined or is blank] *************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : fail when heap size is not specified when using memory lock] ****************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : fail when api credentials are not declared when using security] *************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : fail when ssl enabled without defining a key and certificate] ***************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact file_reserved_users] ***********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : fail when changing users through file realm] ********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact m_lock_enabled] ****************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact use_system_d] ******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : detect if we need the .deb or .rpm] *****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : get the minor version] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set the package_name] *******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : generate the artifacts url] *************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : get latest snapshot build] **************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : use the custom package url instead of the repository] ***********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : split up the snapshot url so we can create the plugin url] ******************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set base plugin url] ********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : create es_plugins with the snapshot url] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item={'plugin': 'ingest-attachment'})

TASK [elasticsearch : override the original es_plugins with the snapshot version] *****************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact java_state to present] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact java_state to latest] **********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : RedHat - Ensure Java is installed] ******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Get the installed java path] ************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : correct java version selected] **********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Refresh java repo] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Ensure Java is installed] ******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : register open_jdk version] **************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : refresh the java ca-certificates] *******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact force_install to no] ***********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact force_install to yes] **********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Check if the elasticsearch package is installed] ****************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : unhold elasticsearch package when switching to a different package type] ****************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : stop elasticsearch] *********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Remove elasticsearch package if we are switching to a different package type] **************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Install apt-transport-https to support https APT downloads] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Add Elasticsearch repository key] **********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Add elasticsearch repository] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item={'repo': 'deb http://packages.elastic.co/elasticsearch/6.x/debian stable main', 'state': 'absent'})
skipping: [172.16.0.21] => (item={'repo': 'deb https://artifacts.elastic.co/packages/6.x/apt stable main', 'state': 'present'})
skipping: [172.16.0.21] => (item={'repo': 'deb https://artifacts.elastic.co/packages/oss-6.x/apt stable main', 'state': 'absent'})

TASK [elasticsearch : Ensure optional elasticsearch group is created with the correct id.] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Ensure optional elasticsearch user is created with the correct id.] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Get installed elasticsearch version] *******************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - unhold elasticsearch version] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Ensure elasticsearch is installed] *********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - hold elasticsearch version] ****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Download elasticsearch from url] ***********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Debian - Ensure elasticsearch is installed from downloaded package] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact allow_downgrade to no] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact allow_downgrade to yes] ********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Ensure libselinux-python on CentOS 6.x] *************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : RedHat - add Elasticsearch repo] ********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : RedHat - remove unused Elasticsearch repo] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : RedHat - install yum-version-lock] ******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : RedHat - check if requested elasticsearch version lock exists] **************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : RedHat - lock elasticsearch version] ****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : RedHat - check if any elasticsearch version lock exists] ********************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : RedHat - unlock elasticsearch version] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : RedHat - Remove the other elasticsearch package if switching between OSS and standard] **************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Ensure optional elasticsearch group is created with the correct id.] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Ensure optional elasticsearch user is created with the correct id.] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : RedHat - Install Elasticsearch] *********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : RedHat - Install Elasticsearch from url] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Create Configuration Directory] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Create PID Directory] *******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Create Others Directories] **************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21] => (item=/var/log/elasticsearch)
changed: [172.16.0.21] => (item=/data)

TASK [elasticsearch : Copy Configuration File] ****************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Copy Default File] **********************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Make sure destination dir exists] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Copy specific ElasticSearch Systemd config file] ****************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Copy jvm.options File] ******************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Copy log4j2.properties File] ************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact es_plugins_reinstall to true] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact list_command] ******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact list_command check for x-pack] *************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : remove x-pack plugin directory when it isn't a plugin] **********************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Check installed elasticsearch plugins] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact plugins_to_remove to install_plugins.stdout_lines] *****************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact plugins_to_remove to delete plugins installed but not listed in es_plugins] ****************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact plugins_to_install to es_plugins] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact to plugins_to_install to those in es_config but not installed] *****************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Remove elasticsearch plugins] ***********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : Install elasticsearch plugins] **********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21] => (item={'plugin': 'ingest-attachment'})

TASK [elasticsearch : create the keystore if it doesn't exist yet] ********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Check if bootstrap password is set] *****************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Create Bootstrap password for elastic user] *********************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Check if old users file exists] *********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Copy the old users file from the old deprecated location] *******************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : List Users] *****************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact users_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Remove Users] ***************************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_add] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Add Users] ******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Set User Passwords] *********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact users_roles] *******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Copy roles.yml File for Instance] *******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Copy User Roles] ************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Copy role_mapping.yml File for Instance] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Set elasticsearch.keystore Permissions] *************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact es_same_keystore] **************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact es_same_keystore if stores match] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : ensure certificate directory exists] ****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Upload SSL/TLS keystore] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Upload SSL/TLS truststore] **************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Upload SSL/TLS key and certificate] *****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21] => (item=files/elasticsearch.key)
changed: [172.16.0.21] => (item=files/elasticsearch.crt)

TASK [elasticsearch : Upload SSL Certificate Authority] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Set keystore password] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21]

TASK [elasticsearch : Set truststore password] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21]

TASK [elasticsearch : Remove keystore password] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item=http)
skipping: [172.16.0.21] => (item=transport)

TASK [elasticsearch : Remove truststore password] *************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item=http)
skipping: [172.16.0.21] => (item=transport)

TASK [elasticsearch : Set key password] ***********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21] => (item=None)
skipping: [172.16.0.21]

TASK [elasticsearch : Remove key password] ********************************************************************************************************************************************************************************************************************************************************
failed: [172.16.0.21] (item=http) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.http.ssl.secure_key_passphrase'", "delta": "0:00:00.643438", "end": "2020-01-22 21:59:56.887355", "item": "http", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 21:59:56.243917", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore."]}
failed: [172.16.0.21] (item=transport) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.transport.ssl.secure_key_passphrase'", "delta": "0:00:00.647511", "end": "2020-01-22 21:59:57.769523", "item": "transport", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 21:59:57.122012", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore."]}
...ignoring

RUNNING HANDLER [elasticsearch : reload systemd configuration] ************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

RUNNING HANDLER [elasticsearch : restart elasticsearch] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.21]

TASK [elasticsearch : Make sure elasticsearch is started] *****************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Wait for elasticsearch to startup] ******************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact manage_native_realm to false] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : set fact manage_native_realm to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Wait 15 seconds for the Native Realm to come up] ****************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Activate ES license (with security authentication)] *************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : License] ********************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Activate ES trial license (with security authentication)] *******************************************************************************************************************************************************************************************************************
ok: [172.16.0.21]

TASK [elasticsearch : Trial license] **************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.21] => {
    "msg": {
        "changed": false,
        "content": "{\"acknowledged\":true,\"trial_was_started\":true,\"type\":\"trial\"}",
        "content_length": "61",
        "content_type": "application/json; charset=UTF-8",
        "cookies": {},
        "cookies_string": "",
        "elapsed": 0,
        "failed": false,
        "json": {
            "acknowledged": true,
            "trial_was_started": true,
            "type": "trial"
        },
        "msg": "OK (61 bytes)",
        "redirected": false,
        "status": 200,
        "url": "http://localhost:9200/_xpack/license/start_trial?acknowledge=true"
    }
}

TASK [elasticsearch : set fact change_api_password to false] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact manage_native_users to false] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact manage_native_users to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact manage_native_role to false] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact manange_native_roles to true] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : List Native Users] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact reserved_users equals user_list_response.json] *********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact current_users equals user_list_response.json.keys not including reserved] ******************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact native_users] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact change_api_password to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Update API User Password] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact es_api_basic_auth_password] ****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact users_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : debug] **********************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Delete Native Users] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_ignore] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : debug message] **************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Update Reserved User Passwords] *********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_modify] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Update Non-Reserved Native User Details] ************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : List Native Roles] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact reserved roles] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact current roles] *****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact roles to ignore] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : debug message] **************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : set fact roles_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Delete Native Roles] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact roles_to_modify] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Update Native Roles] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : ensure templates dir is created] ********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.21]

TASK [elasticsearch : Copy templates to elasticsearch] ********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : Install templates] **********************************************************************************************************************************************************************************************************************************************************

PLAY [data_nodes] *********************************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ****************************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : os-specific vars] ***********************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Set the defaults here otherwise they can't be overriden in the same play if the role is called twice] ***********************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Use the oss repo and package if xpack is not being used] ********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Set the URL scheme to https if SSL/TLS is enabled] **************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : fail when es_proxy_port is not defined or is blank] *************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : fail when heap size is not specified when using memory lock] ****************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : fail when api credentials are not declared when using security] *************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : fail when ssl enabled without defining a key and certificate] ***************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact file_reserved_users] ***********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : fail when changing users through file realm] ********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact m_lock_enabled] ****************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact use_system_d] ******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : detect if we need the .deb or .rpm] *****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : get the minor version] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set the package_name] *******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : generate the artifacts url] *************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : get latest snapshot build] **************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : use the custom package url instead of the repository] ***********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : split up the snapshot url so we can create the plugin url] ******************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set base plugin url] ********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : create es_plugins with the snapshot url] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item={'plugin': 'ingest-attachment'})
skipping: [172.16.0.23] => (item={'plugin': 'ingest-attachment'})

TASK [elasticsearch : override the original es_plugins with the snapshot version] *****************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact java_state to present] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact java_state to latest] **********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : RedHat - Ensure Java is installed] ******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.23]
changed: [172.16.0.22]

TASK [elasticsearch : Get the installed java path] ************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : correct java version selected] **********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Refresh java repo] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Ensure Java is installed] ******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : register open_jdk version] **************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : refresh the java ca-certificates] *******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact force_install to no] ***********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact force_install to yes] **********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Check if the elasticsearch package is installed] ****************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : unhold elasticsearch package when switching to a different package type] ****************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : stop elasticsearch] *********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Remove elasticsearch package if we are switching to a different package type] **************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Install apt-transport-https to support https APT downloads] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Add Elasticsearch repository key] **********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Add elasticsearch repository] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item={'repo': 'deb http://packages.elastic.co/elasticsearch/6.x/debian stable main', 'state': 'absent'})
skipping: [172.16.0.22] => (item={'repo': 'deb https://artifacts.elastic.co/packages/6.x/apt stable main', 'state': 'present'})
skipping: [172.16.0.22] => (item={'repo': 'deb https://artifacts.elastic.co/packages/oss-6.x/apt stable main', 'state': 'absent'})
skipping: [172.16.0.23] => (item={'repo': 'deb http://packages.elastic.co/elasticsearch/6.x/debian stable main', 'state': 'absent'})
skipping: [172.16.0.23] => (item={'repo': 'deb https://artifacts.elastic.co/packages/6.x/apt stable main', 'state': 'present'})
skipping: [172.16.0.23] => (item={'repo': 'deb https://artifacts.elastic.co/packages/oss-6.x/apt stable main', 'state': 'absent'})

TASK [elasticsearch : Ensure optional elasticsearch group is created with the correct id.] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Ensure optional elasticsearch user is created with the correct id.] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Get installed elasticsearch version] *******************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - unhold elasticsearch version] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Ensure elasticsearch is installed] *********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - hold elasticsearch version] ****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Download elasticsearch from url] ***********************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Debian - Ensure elasticsearch is installed from downloaded package] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact allow_downgrade to no] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact allow_downgrade to yes] ********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Ensure libselinux-python on CentOS 6.x] *************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : RedHat - add Elasticsearch repo] ********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : RedHat - remove unused Elasticsearch repo] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : RedHat - install yum-version-lock] ******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : RedHat - check if requested elasticsearch version lock exists] **************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : RedHat - lock elasticsearch version] ****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : RedHat - check if any elasticsearch version lock exists] ********************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : RedHat - unlock elasticsearch version] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : RedHat - Remove the other elasticsearch package if switching between OSS and standard] **************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Ensure optional elasticsearch group is created with the correct id.] ********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Ensure optional elasticsearch user is created with the correct id.] *********************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : RedHat - Install Elasticsearch] *********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : RedHat - Install Elasticsearch from url] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Create Configuration Directory] *********************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Create PID Directory] *******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Create Others Directories] **************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22] => (item=/var/log/elasticsearch)
changed: [172.16.0.23] => (item=/var/log/elasticsearch)
changed: [172.16.0.22] => (item=/data)
changed: [172.16.0.23] => (item=/data)

TASK [elasticsearch : Copy Configuration File] ****************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Copy Default File] **********************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Make sure destination dir exists] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Copy specific ElasticSearch Systemd config file] ****************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Copy jvm.options File] ******************************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Copy log4j2.properties File] ************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact es_plugins_reinstall to true] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact list_command] ******************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact list_command check for x-pack] *************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : remove x-pack plugin directory when it isn't a plugin] **********************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Check installed elasticsearch plugins] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact plugins_to_remove to install_plugins.stdout_lines] *****************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact plugins_to_remove to delete plugins installed but not listed in es_plugins] ****************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact plugins_to_install to es_plugins] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact to plugins_to_install to those in es_config but not installed] *****************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Remove elasticsearch plugins] ***********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : Install elasticsearch plugins] **********************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.23] => (item={'plugin': 'ingest-attachment'})
changed: [172.16.0.22] => (item={'plugin': 'ingest-attachment'})

TASK [elasticsearch : create the keystore if it doesn't exist yet] ********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Check if bootstrap password is set] *****************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.23]
ok: [172.16.0.22]

TASK [elasticsearch : Create Bootstrap password for elastic user] *********************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set_fact] *******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Check if old users file exists] *********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Copy the old users file from the old deprecated location] *******************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : List Users] *****************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact users_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Remove Users] ***************************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_add] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Add Users] ******************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Set User Passwords] *********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact users_roles] *******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Copy roles.yml File for Instance] *******************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Copy User Roles] ************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Copy role_mapping.yml File for Instance] ************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Set elasticsearch.keystore Permissions] *************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact es_same_keystore] **************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact es_same_keystore if stores match] **********************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : ensure certificate directory exists] ****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Upload SSL/TLS keystore] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Upload SSL/TLS truststore] **************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Upload SSL/TLS key and certificate] *****************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22] => (item=files/elasticsearch.key)
changed: [172.16.0.23] => (item=files/elasticsearch.key)
changed: [172.16.0.22] => (item=files/elasticsearch.crt)
changed: [172.16.0.23] => (item=files/elasticsearch.crt)

TASK [elasticsearch : Upload SSL Certificate Authority] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Set keystore password] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22]
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23]

TASK [elasticsearch : Set truststore password] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22]
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23]

TASK [elasticsearch : Remove keystore password] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item=http)
skipping: [172.16.0.22] => (item=transport)
skipping: [172.16.0.23] => (item=http)
skipping: [172.16.0.23] => (item=transport)

TASK [elasticsearch : Remove truststore password] *************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item=http)
skipping: [172.16.0.22] => (item=transport)
skipping: [172.16.0.23] => (item=http)
skipping: [172.16.0.23] => (item=transport)

TASK [elasticsearch : Set key password] ***********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22] => (item=None)
skipping: [172.16.0.22]
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23] => (item=None)
skipping: [172.16.0.23]

TASK [elasticsearch : Remove key password] ********************************************************************************************************************************************************************************************************************************************************
failed: [172.16.0.23] (item=http) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.http.ssl.secure_key_passphrase'", "delta": "0:00:00.743584", "end": "2020-01-22 22:01:27.251764", "item": "http", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 22:01:26.508180", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore."]}
failed: [172.16.0.22] (item=http) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.http.ssl.secure_key_passphrase'", "delta": "0:00:00.811020", "end": "2020-01-22 22:01:27.304639", "item": "http", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 22:01:26.493619", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.http.ssl.secure_key_passphrase] does not exist in the keystore."]}
failed: [172.16.0.23] (item=transport) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.transport.ssl.secure_key_passphrase'", "delta": "0:00:00.748860", "end": "2020-01-22 22:01:28.264975", "item": "transport", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 22:01:27.516115", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore."]}
...ignoring
failed: [172.16.0.22] (item=transport) => {"ansible_loop_var": "item", "changed": true, "cmd": "/usr/share/elasticsearch/bin/elasticsearch-keystore remove 'xpack.security.transport.ssl.secure_key_passphrase'", "delta": "0:00:00.747779", "end": "2020-01-22 22:01:28.305353", "item": "transport", "msg": "non-zero return code", "rc": 78, "start": "2020-01-22 22:01:27.557574", "stderr": "", "stderr_lines": [], "stdout": "ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore.", "stdout_lines": ["ERROR: Setting [xpack.security.transport.ssl.secure_key_passphrase] does not exist in the keystore."]}
...ignoring

RUNNING HANDLER [elasticsearch : reload systemd configuration] ************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

RUNNING HANDLER [elasticsearch : restart elasticsearch] *******************************************************************************************************************************************************************************************************************************************
changed: [172.16.0.22]
changed: [172.16.0.23]

TASK [elasticsearch : Make sure elasticsearch is started] *****************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : Wait for elasticsearch to startup] ******************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.23]
ok: [172.16.0.22]

TASK [elasticsearch : set fact manage_native_realm to false] **************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22]
ok: [172.16.0.23]

TASK [elasticsearch : set fact manage_native_realm to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Wait 15 seconds for the Native Realm to come up] ****************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Activate ES license (with security authentication)] *************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : License] ********************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Activate ES trial license (with security authentication)] *******************************************************************************************************************************************************************************************************************
ok: [172.16.0.23]
ok: [172.16.0.22]

TASK [elasticsearch : Trial license] **************************************************************************************************************************************************************************************************************************************************************
ok: [172.16.0.22] => {
    "msg": {
        "changed": false,
        "content": "{\"acknowledged\":true,\"trial_was_started\":false,\"error_message\":\"Operation failed: Trial was already activated.\"}",
        "content_length": "112",
        "content_type": "application/json; charset=UTF-8",
        "elapsed": 0,
        "failed": false,
        "json": {
            "acknowledged": true,
            "error_message": "Operation failed: Trial was already activated.",
            "trial_was_started": false
        },
        "msg": "HTTP Error 403: Forbidden",
        "redirected": false,
        "status": 403,
        "url": "http://localhost:9200/_xpack/license/start_trial?acknowledge=true"
    }
}
ok: [172.16.0.23] => {
    "msg": {
        "changed": false,
        "content": "{\"acknowledged\":true,\"trial_was_started\":false,\"error_message\":\"Operation failed: Trial was already activated.\"}",
        "content_length": "112",
        "content_type": "application/json; charset=UTF-8",
        "elapsed": 0,
        "failed": false,
        "json": {
            "acknowledged": true,
            "error_message": "Operation failed: Trial was already activated.",
            "trial_was_started": false
        },
        "msg": "HTTP Error 403: Forbidden",
        "redirected": false,
        "status": 403,
        "url": "http://localhost:9200/_xpack/license/start_trial?acknowledge=true"
    }
}

TASK [elasticsearch : set fact change_api_password to false] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact manage_native_users to false] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact manage_native_users to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact manage_native_role to false] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact manange_native_roles to true] **************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : List Native Users] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact reserved_users equals user_list_response.json] *********************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact current_users equals user_list_response.json.keys not including reserved] ******************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact native_users] ******************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact change_api_password to true] ***************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Update API User Password] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact es_api_basic_auth_password] ****************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact users_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : debug] **********************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Delete Native Users] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_ignore] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : debug message] **************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Update Reserved User Passwords] *********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact users_to_modify] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Update Non-Reserved Native User Details] ************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : List Native Roles] **********************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact reserved roles] ****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact current roles] *****************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact roles to ignore] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : debug message] **************************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : set fact roles_to_remove] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Delete Native Roles] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : set fact roles_to_modify] ***************************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Update Native Roles] ********************************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : ensure templates dir is created] ********************************************************************************************************************************************************************************************************************************************
skipping: [172.16.0.22]
skipping: [172.16.0.23]

TASK [elasticsearch : Copy templates to elasticsearch] ********************************************************************************************************************************************************************************************************************************************

TASK [elasticsearch : Install templates] **********************************************************************************************************************************************************************************************************************************************************

PLAY RECAP ****************************************************************************************************************************************************************************************************************************************************************************************
172.16.0.21                : ok=52   changed=18   unreachable=0    failed=0    skipped=107  rescued=0    ignored=1
172.16.0.22                : ok=52   changed=18   unreachable=0    failed=0    skipped=107  rescued=0    ignored=1
172.16.0.23                : ok=52   changed=18   unreachable=0    failed=0    skipped=106  rescued=0    ignored=1